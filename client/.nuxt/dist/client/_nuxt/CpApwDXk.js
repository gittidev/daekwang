import{c as z,t as D,r as N,f as P,d as I,u as M,a as k,w as O,b as g,o as c,e as Z,g as t,h as F,i as T,v as L,j as G,k as v,l as J,m as K,n as H,p as j,F as R,q,s as Q,T as W,_ as X}from"./CzpvF0SR.js";import{h as Y,u as B}from"./BrDmpX_n.js";import{u as tt}from"./Dq5W4uQx.js";import{u as et}from"./yF3l_Q4x.js";function st(y,u,m){const[r={},x]=typeof u=="string"?[{},u]:[u,m],i=z(()=>D(y)),d=r.key||Y([x,typeof i.value=="string"?i.value:"",...ot(r)]);if(!d||typeof d!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+d);if(!y)throw new Error("[nuxt] [useFetch] request is missing.");const o=d===x?"$f"+d:d;if(!r.baseURL&&typeof i.value=="string"&&i.value[0]==="/"&&i.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:b,lazy:p,default:f,transform:$,pick:h,watch:w,immediate:_,getCachedData:s,deep:E,dedupe:U,...l}=r,C=N({...P,...l,cache:typeof r.cache=="boolean"?void 0:r.cache}),n={server:b,lazy:p,default:f,transform:$,pick:h,immediate:_,getCachedData:s,deep:E,dedupe:U,watch:w===!1?[]:[C,i,...w||[]]};let e;return tt(o,()=>{var A;(A=e==null?void 0:e.abort)==null||A.call(e,new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),e=typeof AbortController<"u"?new AbortController:{};const V=D(r.timeout);let S;return V&&(S=setTimeout(()=>e.abort(new DOMException("Request aborted due to timeout.","AbortError")),V),e.signal.onabort=()=>clearTimeout(S)),(r.$fetch||globalThis.$fetch)(i.value,{signal:e.signal,...C}).finally(()=>{clearTimeout(S)})},n)}function ot(y){var m;const u=[((m=D(y.method))==null?void 0:m.toUpperCase())||"GET",D(y.baseURL)];for(const r of[y.params||y.query]){const x=D(r);if(!x)continue;const i={};for(const[d,o]of Object.entries(x))i[D(d)]=D(o);u.push(i)}return u}const lt={key:0,class:"text-sm text-gray-500 mt-1"},at={key:1,class:"mt-2 relative w-fit"},nt=["src"],rt={class:"flex gap-2"},it={class:"inline-flex items-center space-x-2"},ut={class:"flex justify-end gap-2 mt-4"},dt=["disabled"],pt=I({__name:"ConstructionForm",props:{construction:{}},emits:["saved","cancel"],setup(y,{emit:u}){var U,l,C;const m=B("access_token").value,r=M(),{public:{apiUrl:x}}=r,i=y,d=u,o=k({...i.construction}),b=k(null),p=k(o.value.thumbnail||null),f=k(!1),$=k(((U=o.value.period)==null?void 0:U.split(" ~ ")[0])||""),h=k(((l=o.value.period)==null?void 0:l.split(" ~ ")[1])||""),w=k(((C=o.value.total_price)==null?void 0:C.toLocaleString())||"");O(w,n=>{const e=n.replace(/[^\d]/g,"");o.value.total_price=parseInt(e||"0"),w.value=e?Number(e).toLocaleString():""}),O([$,h],([n,e])=>{n&&e&&(o.value.period=`${n} ~ ${e}`)});const _=n=>{var a;const e=n.target;(a=e.files)!=null&&a[0]&&(b.value=e.files[0],p.value=URL.createObjectURL(b.value))},s=()=>{b.value=null,p.value=null,o.value.thumbnail=""},E=async()=>{f.value=!0;try{const n=o.value.id===0,e=new FormData;e.append("place",o.value.place),e.append("period",o.value.period),e.append("description",o.value.description),e.append("is_published",String(o.value.is_published)),e.append("total_price",String(o.value.total_price??"")),b.value&&e.append("file",b.value);const a=n?`${x}/admin/constructions/create`:`${x}/admin/constructions/${o.value.id}`;await $fetch(a,{method:n?"POST":"PUT",body:e,headers:{Authorization:`Bearer ${m}`}}),d("saved")}catch(n){console.error("등록 실패",n),alert("저장 실패")}finally{f.value=!1}};return(n,e)=>(c(),g("form",{onSubmit:Z(E,["prevent"]),class:"space-y-4"},[t("div",null,[e[7]||(e[7]=t("label",{class:"block font-medium mb-1"},"썸네일 이미지",-1)),t("input",{type:"file",accept:"image/*",onChange:_,class:"block"},null,32),p.value?F("",!0):(c(),g("p",lt," 이미지를 선택하거나 드래그하세요. ")),p.value?(c(),g("div",at,[t("img",{src:p.value,alt:"미리보기",class:"w-48 h-auto border rounded"},null,8,nt),t("button",{type:"button",onClick:s,class:"absolute top-1 right-1 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded hover:bg-opacity-80"}," 삭제 ")])):F("",!0)]),t("div",null,[e[8]||(e[8]=t("label",{class:"block font-medium mb-1"},"장소",-1)),T(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.place=a),type:"text",class:"w-full px-3 py-2 border rounded"},null,512),[[L,o.value.place]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block font-medium mb-1"},"기간",-1)),t("div",rt,[T(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>$.value=a),type:"date",class:"px-3 py-2 border rounded"},null,512),[[L,$.value]]),e[9]||(e[9]=t("span",{class:"self-center"},"~",-1)),T(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>h.value=a),type:"date",class:"px-3 py-2 border rounded"},null,512),[[L,h.value]])])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block font-medium mb-1"},"설명",-1)),T(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.description=a),rows:"3",class:"w-full px-3 py-2 border rounded resize-none"},null,512),[[L,o.value.description]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block font-medium mb-1"},"총 금액",-1)),T(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>w.value=a),type:"text",inputmode:"numeric",placeholder:"예: 1,000,000",class:"w-full px-3 py-2 border rounded"},null,512),[[L,w.value]])]),t("div",null,[t("label",it,[T(t("input",{type:"checkbox","onUpdate:modelValue":e[5]||(e[5]=a=>o.value.is_published=a)},null,512),[[G,o.value.is_published]]),e[13]||(e[13]=t("span",null,"공개 여부",-1))])]),t("div",ut,[t("button",{type:"button",onClick:e[6]||(e[6]=a=>n.$emit("cancel")),class:"px-4 py-2 rounded bg-gray-300 text-gray-800 hover:bg-gray-400"}," 취소 "),t("button",{type:"submit",disabled:f.value,class:"px-4 py-2 rounded bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50"},v(f.value?"저장 중...":"저장"),9,dt)])],32))}}),ct={class:"admin-page"},yt={class:"flex justify-between items-center mb-6"},xt={key:0,class:"overflow-x-auto bg-white shadow-sm rounded-lg"},bt={class:"min-w-full table-auto border-collapse"},ft={class:"px-4 py-2"},vt={class:"px-4 py-2"},gt={class:"px-4 py-2"},mt={class:"px-4 py-2"},ht={class:"px-4 py-2"},wt={class:"px-4 py-2"},_t={class:"px-4 py-2"},kt={class:"px-4 py-2"},$t=["onClick"],Ct=["onClick"],Ut={key:1,class:"overflow-x-auto bg-white shadow-sm rounded-lg"},Dt={class:"min-w-full table-auto border-collapse"},Et={class:"px-4 py-2"},Tt={key:0,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},Lt={class:"bg-white p-6 rounded-lg w-full max-w-xl shadow-lg relative"},St={class:"text-xl font-bold mb-4"},jt=I({__name:"constructions",async setup(y){let u,m;const r=J(),{isLoggedIn:x}=et(),i=M(),d=B("admin_token").value;x.value||r.push("/admin/login");const{data:o,refresh:b}=([u,m]=K(()=>st(`${i.public.apiUrl}/admin/constructions`,{headers:{Authorization:`Bearer ${d}`}},"$JjEZL0jZfU")),u=await u,m(),u),p=k(null),f=k(!1),$=_=>{p.value=_?{..._}:{id:0,place:"",period:"",description:"",is_published:!1,created_at:"",thumbnail:"",total_price:0},f.value=!0},h=()=>{p.value=null,f.value=!1},w=async _=>{if(confirm("정말 삭제하시겠습니까?"))try{await $fetch(`/api/admin/constructions/${_}`,{method:"DELETE"}),await b(),alert("삭제 완료")}catch{alert("삭제 실패")}};return(_,s)=>{var E,U;return c(),g("div",ct,[t("div",yt,[s[2]||(s[2]=t("div",null,[t("h1",{class:"text-3xl font-bold"},"🛠️ 시공 내역 관리"),t("p",{class:"text-gray-500 text-sm mt-1"}," 등록된 모든 시공 정보를 확인하고 관리할 수 있습니다. ")],-1)),t("button",{onClick:s[0]||(s[0]=l=>$(null)),class:"px-4 py-2 rounded-md bg-green-500 text-white hover:bg-green-600 transition"}," ➕ 등록하기 ")]),(E=j(o))!=null&&E.length?(c(),g("div",xt,[t("table",bt,[s[3]||(s[3]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"px-4 py-2 text-left text-gray-600"},"ID"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"장소"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"기간"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"설명"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"공개 여부"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"가격"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"등록일"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"수정/삭제")])],-1)),t("tbody",null,[(c(!0),g(R,null,q(j(o),l=>{var C;return c(),g("tr",{key:l.id,class:"border-b hover:bg-gray-50"},[t("td",ft,v(l.id),1),t("td",vt,v(l.place),1),t("td",gt,v(l.period),1),t("td",mt,v(l.description||"설명 없음"),1),t("td",ht,v(l.is_published?"공개":"비공개"),1),t("td",wt,v(((C=l.total_price)==null?void 0:C.toLocaleString())||"미입력"),1),t("td",_t,v(l.created_at.slice(0,10)),1),t("td",kt,[t("button",{onClick:n=>$(l),class:"text-sm px-3 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200"}," ✏️ 수정 ",8,$t),t("button",{onClick:n=>w(l.id),class:"text-sm px-3 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200"}," 🗑️ 삭제 ",8,Ct)])])}),128))])])])):(c(),g("div",Ut,[t("table",Dt,[s[11]||(s[11]=t("thead",null,[t("tr",{class:"bg-gray-100"},[t("th",{class:"px-4 py-2 text-left text-gray-600"},"ID"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"장소"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"기간"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"설명"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"공개 여부"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"가격"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"등록일"),t("th",{class:"px-4 py-2 text-left text-gray-600"},"수정/삭제")])],-1)),t("tbody",null,[(c(),g(R,null,q(2,l=>t("tr",{key:l,class:"border-b hover:bg-gray-50"},[s[4]||(s[4]=t("td",{class:"px-4 py-2"},"1",-1)),t("td",Et,"예시 장소 "+v(l),1),s[5]||(s[5]=t("td",{class:"px-4 py-2"},"2023.01 ~ 2023.03",-1)),s[6]||(s[6]=t("td",{class:"px-4 py-2"},"예시 설명",-1)),s[7]||(s[7]=t("td",{class:"px-4 py-2"},"공개",-1)),s[8]||(s[8]=t("td",{class:"px-4 py-2"},"100,000",-1)),s[9]||(s[9]=t("td",{class:"px-4 py-2"},"2023-01-01",-1)),s[10]||(s[10]=t("td",{class:"px-4 py-2"},[t("button",{disabled:"",class:"text-sm px-3 py-1 bg-gray-200 text-gray-400 cursor-not-allowed"}," ✏️ 수정 "),t("button",{disabled:"",class:"text-sm px-3 py-1 bg-gray-200 text-gray-400 cursor-not-allowed"}," 🗑️ 삭제 ")],-1))])),64))])])])),(c(),H(W,{to:"body"},[f.value?(c(),g("div",Tt,[t("div",Lt,[t("button",{onClick:h,class:"absolute top-3 right-3 text-gray-400 hover:text-black text-xl"}," × "),t("h2",St,v(((U=p.value)==null?void 0:U.id)===0?"📝 시공 등록":"✏️ 시공 수정"),1),Q(pt,{construction:p.value,onSaved:s[1]||(s[1]=()=>{h(),j(b)()}),onCancel:h},null,8,["construction"])])])):F("",!0)]))])}}}),qt=X(jt,[["__scopeId","data-v-c89d3b24"]]);export{qt as default};
